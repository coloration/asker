<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Coloration Asker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/mono-blue.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
</head>
<style>
  * {
    margin: 0;
    padding: 0;
    text-decoration: none;
    list-style: none;
  }

  body {
    color: #474747;
  }

  .container {
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    padding-left: 30px;
    padding-right: 30px;
  }

  .light-color {
    color: #f0f0f0;
  }

  .dark-color {
    color: #333;
  }

  .text-center {
    text-align: center;
  }

  .mgb-10 {
    margin-bottom: 10px;
  }


  .mgb-20 {
    margin-bottom: 20px;
  }

  .mgb-40 {
    margin-bottom: 40px;
  }

  .code-box {
    overflow-x: auto;
    padding: 10px 6px;
    margin: 0 -6px 10px;
    background-color: #eaeef3;
  }

  #toc {
    margin: 20px 0;
  }

  #toc li {
    color: #999;
    height: 30px;
    line-height: 30px;
    position: relative;
  }

  #toc li::before {
    content: "";
    position: absolute;
    font-size: 100px;
    width: 0.06em;
    height: 0.06em;
    margin-top: -0.03em;
    color: steelblue;
    background-color: currentColor;
    left: -14px;
    top: 50%;
    border-radius: 50%;
  }

  #toc a {
    color: #999;
  }

  #toc ul {
    padding-left: 12px;
  }

  header {
    padding: 30px 0;
    background-color: steelblue;
  }

  h1 {
    text-align: center;
    font-size: 5em;
  }

  header .desc {
    font-size: 1.5em;

  }

  h2 {
    font-size: 1.8em;
    padding: 10px 0px;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
  }

  h3 {
    font-size: 1.5em;
    padding: 8px 0px;
    margin-bottom: 8px;
  }

  p {
    font-size: 1em;
    margin-bottom: 8px;
    line-height: 1.5em;
    /* text-align: justify; */
  }

  footer {
    background: #666;
    height: 200px;
    color: #f0f0f0;
    padding: 20px 0;
    font-size: .9em;
  }

  footer a {
    color: #f0f0f0;
  }

  footer a:hover {
    text-decoration: underline;
  }
</style>

<body>
  <header id="header">
    <h1 class="light-color text-center">Asker</h1>
    <p class="light-color text-center desc mgb-40">
      <em>a simple RESTful request tool for client</em>
    </p>
    <div class="text-center mgb-20">
      <img src="https://img.shields.io/npm/v/@coloration/asker.svg" alt="version">
      <img src="https://img.shields.io/npm/l/@coloration/asker.svg" alt="lic">
      <img src="https://img.shields.io/npm/dm/@coloration/asker.svg" alt="Download">
      <img src="https://img.shields.io/bundlephobia/min/@coloration/asker@0.7.0" alt="min">
      <img src="https://img.shields.io/bundlephobia/minzip/@coloration/asker@0.7.0" alt="minzip">
    </div>
    <div class="light-color container">
      <code>
      <pre>
$ yarn add @coloration/asker -S
$ npm i @coloration/asker -S
    </pre>
  </code>

      <code>
    <pre>
import Asker from '@coloration/asker'
// or link https://raw.githubusercontent.com/coloration/asker/master/lib/index.min.js

Asker.get('http://api.io/list', { page: 1, size: 20 })
      </pre>
    </code>
    </div>
  </header>

  <section class="container">
    <ul id="toc">
      <li>
        <a href="#instance">Instance</a>
      </li>
      <li>
        <a href="#methods">Methods</a>
      </li>
      <ul>
        <li><a href="#methods-normal">Normal</a></li>
        <li><a href="#methods-jsonp">JSONP</a></li>
        <li><a href="#methods-batch">Batch Request</a></li>
        <li><a href="#methods-custom-mock">Custom & Mock</a></li>
      </ul>
      <li>
        <a href="#features">Features</a>

      </li>
      <ul>
        <li><a href="#features-cache">Cache responses for Getlike methods</a></li>
        <li><a href="#features-posttype">Post Type</a></li>
        <li><a href="#features-cancel">Cancel Request</a></li>
        <li><a href="#features-timeout">Timeout</a></li>
      </ul>
    </ul>
    <h2 id="instance">Instance</h2>
    <p>You can <code>new</code> a object to cache some configure</p>
    <div class="code-box">
      <pre><code class="javascript">import Asker from '@coloration/asker'

const api = new Asker({
  baseUrl: 'http://api.io'
})

api.get('/list', { page: 1, size: 20 })
api.post('/article', { title: 'a article', content: 'write ...' })
</code></pre>
    </div>

    <p>Below is a detail configure for Asker, there are some example for configure after this: </p>
    <div class="code-box">
      <pre><code class="javascript">export interface AskerConf {
  /** a sub url, it will be added after `baseUrl` at last */
  url?: string,
  
  /** the url first part */
  baseUrl?: string,
  
  /** the string result */
  query?: string,
  
  /** the transferred object for post  */
  body?: any,
  
  /** if you need to set the query string when you call the post like methods, you could set this  */
  params?: { [key: string]: any },
  
  /** request method, will be override when you invoke instance[method] */
  method?: 'get' | 'option' | 'head' | 'post' | 'put' | 'patch' | 'delete',
  
  /** request headers */
  headers?: { [key: string]: any }

  /** will cache response after first (getLike) request, second will return the cache */
  getCache?: boolean

  /** asker will change the data type auto by this */
  postType?: 'json' | 'form-data' | 'text' | 'form-urlencoded',
  
  /** default 'object' will call 'JSON.parse()', other return string */
  responseType?: 'object' | 'text',
  
  /** waiting over timeout(MS), asker will call the 'onTimeout' or 'reject' */
  timeout?: number,

  /** set `XMLHTTPRequest` withCredentials */
  withCredentials?: true,

  /** custom validator, default is `status >= 200 && status < 300` */
  validator?: (status: number) => boolean,

  /** custom adapter: you can replace default xhr adapter, `Asker.jsonp` is implemented by this way。
    * it also can be used in mock, you can pass a data (except `undefined`), it will return a response 
    * wrapped by `AskerResponse` object. Or you pass a function return a custom data
  */
  adapter?: string | number | boolean | { [key: string]: any } | any[] |
    ((response: any, defaultResponse: AskerResponse) => Promise<any>) | 
    (<T>(response: T, defaultResponse: AskerResponse) => Promise<T>)
  ,
  
  /** hook chain change the `AskerConf` before the request  */
  before?: (conf: AskerConf) => AskerConf | ((conf: AskerConf) => AskerConf)[],
  
  /** hook chain change your resopnse after the request */
  after?: (response: any) => any

  /** called when xhr trigger `error` event */
  onError?: (errType: string, xhr: XMLHttpRequest, conf: AskerConf) => any,

  /** called when xhr trigger `abort` event */
  onAbort?: (errType: string, xhr: XMLHttpRequest, conf: AskerConf) => any,

  /** called when xhr trigger `timeout` event */
  onTimeout?: (errType: string, xhr: XMLHttpRequest, conf: AskerConf) => any,

  /** called when xhr trigger `upload.progress` event */
  onUploadProgress?: (e: ProgressEvent, xhr: XMLHttpRequest, conf: AskerConf) => any,
  
  /** called when xhr trigger `progress` event */
  onDownloadProgress?: (e: ProgressEvent, xhr: XMLHttpRequest, conf: AskerConf) => any

  /** cancellion */
  canceler?: Canceler

  /** other custom props */
  [key: string]: any
}</code></pre>
    </div>


    <h2 id="methods">Methods</h2>
    <h3 id="methods-normal">Normal</h3>
    <div class="code-box">
      <pre><code class="javascript">import Asker from '@coloration/asker'

Asker.get('http://api.io', { page: 1, size: 20 })
Asker.post(
  'http:/api.io/article', 
  { content: 'write ...'},
  { 
    query: 'title=article' 
    // or
    params: { title: 'article' }
  }
)</code></pre>
    </div>
    <p>all methods: </p>
    <p>
      <span>post like:</span>
      <code>post</code>
      <code>patch</code>
      <code>put</code>
    </p>
    <p>
      <span>get like:</span>
      <code>get</code>
      <code>delete</code>
      <code>options</code>
      <code>head</code>
    </p>
    <h3 id="methods-jsonp">JSONP</h3>
    <p>the <code>jsonp</code> field get from backend developer or document of the origin server.</p>
    <p><span class="Note"></span> jsonp is a outdate way to handle the across origin.</p>
    <div class="code-box">
      <pre><code class="javascript">Asker.jsonp(
  'http://api.io/jsonp', { page: 1, size: 20 }, { jsonp: 'jsoncallback' }
)

// or special callback name in 2rd parameter 
Asker.jsonp(
  'http://api.io/jsop?page=1&size=20', 'jsoncallback'
)
</pre></code>
    </div>
    <h3 id="methods-batch">Batch Requests</h3>
    <div class="code-box">
      <code><pre>
Asker.batch(
  'http://api.io/upload', 
  // an array or a normal param
  [{ file: file1 }, { file: file2 }], 
  { 
    method: 'post',
    // max number of batchs in same tile, default is the array length
    slice: 3,
    // retry times of a batch when request failure, default is 0 times
    retry: 2
  }
)
// apply the Promise.all for these requests
.then(allResponses => {})</code></pre>
    </div>
    <h3 id="methods-custom-mock">Custom & Mock</h3>
    <p>
      The <code>jsonp</code> and <code>batch</code> are implemented by <code>apater</code>.
      We also could implement some other methods. Other platforms, for example, miniprogram,
      its enviorment support JavaScript, but not support XMLHTTPRequest.
    </p>
    <div class="code-box">
      <pre><code class="javascript">export function get (url, params, conf) {
  return Asker.get(url, params, Object.assign(conf, {
    adapter (conf) {
      // ...
      return wx.http(/* ... */)
    }
  }))
}</code></pre>
    </div>
    <p>
      You are mocking when you return a data in the adapter function instead of the promise.
      You could also pass a normal data to <code>adapter</code>.
    </p>
    <div class="code-box">
      <pre><code class="javascript">Asker.get('whatever string', whateverParam, {
  adapter: [1, 2, 3]
})
.then(response => {}) // [1, 2, 3]
}</code></pre>
    </div>
    <h2 id="features">Features</h2>
    <h3 id="features-cache">Cache responses for Getlike methods</h3>
    <p>When we special <code>getCache : true</code>，Asker hold the response in
      <code>Asker.cache</code> object with the url and query until you reload the browser.</p>
    <p>When we request with the same url, params and <code>getCache</code> configure field,
      Asker will find from the <code>Asker.cache</code> firstly. Inexsitly, will request.</p>
    <div class="code-box">
      <pre><code class="javascript">// request
Asker.get('http://api.io/config', { type: 1 }, { getCache: true }) 
// find response from cache
Asker.get('http://api.io/config', { type: 1 }, { getCache: true }) 
// request
Asker.get('http://api.io/config', { type: 2 }, { getCache: true }) </code></pre>
    </div>
    <h3 id="features-posttype">Post Type</h3>
    <p>Asker will transform the body type when you set the <code>postType</code> field. Default is <code>json</code></p>
    <div class="code-box">
      <pre><code class="javascript">Asker.post(
  'http://api.io/upload', 
  { file: file, name: 'photoname' },
  { postType: 'form-data' }
)
.then(res => {})</code></pre>
    </div>
    <h3 id="features-cancel">Cancel Request</h3>

<p>after calling the cancel methods, we will receive an error in <code>promise.catch</code> or <code>conf.onAbort</code> method.</p>

    <div class="code-box">
      <pre><code class="javascript">import { Canceler } from '@coloration/asker'

const canceler = new Canceler()

Asker.get('http://api.io/eg1', null, { canceler })
Asker.get('http://api.io/eg2', null, { canceler })

canceler.cancel()</code></pre>
    </div>

    <h3 id="features-timeout">Timeout</h3>

    <p>if response timeout, we will receive an error in <code>promise.catch</code> or <code>conf.onTimeout</code> method.</p>

    <div class="code-box">
      <pre><code class="javascript">Asker.get('http://api.io/test-timeout', null, { 
  timeout: 3000,
  onTimeout: (error, xhr, conf) => {}
})

Asker.get('http://api.io/test-timeout2', null, { timeout: 3000 })
.catch(error => {
  const { status, message } = error

  status === 0
  message === Asker.errorType.TIMEOUT
})</code></pre>
    </div>
    <h2 id="upload-download-progress">Upload & Download Progress</h2>
    <h2 id="auth-with-before">Auth with before</h2>
    <h2 id="format-with-after">Format with after</h2>


  </section>

  <footer>
    <div class="container">
      <p>Author: wangbinyu / 406279919@qq.com</p>
      <p>Github: <a href="https://github.com/coloration/asker">https://github.com/coloration/asker</a></p>
    </div>
  </footer>
</body>
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre code').forEach((block) => {
      hljs.highlightBlock(block);
    });
  })
  function debounce(fn, time) {
    var timer
    var _this = this

    return function () {
      var _arg = arguments
      clearTimeout(timer)
      timer = setTimeout(function () {
        fn.apply(_this, _arg)
      }, time)
    }
  }

  function throttle(fn, time) {
    var hasRun = false
    var _this = this
    return function () {
      if (hasRun) return
      fn.apply(_this, arguments)
      hasRun = true
      setTimeout(function () {
        hasRun = false
      }, time)
    }
  }

// var tocDom = document.getElementById('toc')
// var h2Doms = document.getElementsByTagName('h2')

// for (var i = 0; i < h2Doms.length; i++) {
//   var h2Dom = h2Doms[i]
//   var liDom = document.createElement('li')
//   liDom.innerHTML = '<a href="#' + h2Dom.id+ '">' + h2Dom.innerHTML + '</a>'

//   tocDom.appendChild(liDom)
// }




</script>

</html>