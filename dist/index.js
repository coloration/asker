!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).asker={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a="Content-Type",u={data:null,status:200,statusText:"you skip request and success always",headers:{},conf:{},request:null},c="ASKER:REQUEST_ABORT",f="ASKER:REQUEST_ERROR",l="ASKER:REQUEST_TIMEOUT",p=["get","delete","head","options"],r=["post","put","patch"];function d(e){return"function"==typeof e}function y(e){return"[object Object]"===Object.prototype.toString.call(e)}function h(e){return"number"==typeof e&&!isNaN(e)}function m(e){return void 0===e}function b(e){return Array.isArray(e)}function i(e){return y(e)||b(e)}function o(e){return"string"==typeof e}function v(n,r){if(null!=r)if("object"!=t(r))n(r,0,r);else if(b(r))r.forEach(function(e,t){n.call(null,e,t,r)});else for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&n.call(null,r[e],e,r)}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!y(e))return"";var r=[];return v(function(e,t){e=n?encodeURIComponent(e):e,r.push("".concat(t,"=").concat(e))},e),r.join("&")}function T(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(i),o=r.shift();return r.reduce(function(r,e){if(!i(e))throw TypeError("merge a ".concat(e," to object"));return v(function(e,t){var n=r[t];y(e)?r[t]=T(y(n)?n:{},e):b(e)?r[t]=T(b(n)?n:[],e):r[t]=e},e),r},o),o}function R(){var n=[],r=[];return Array.from(arguments).filter(function(e){return e}).forEach(function(e){var t=e.before,e=e.after;(d(t)||b(t))&&(n=n.concat(t)),(d(e)||b(e))&&(r=r.concat(e))}),{beforeQueue:n,afterQueue:r}}var E=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];function j(e,t,n){return{status:e,message:t,response:n}}var x={};function s(e){if(!(this instanceof s))return new s(e);var t=T({},s.conf,e);this.conf=Object.assign(t,R(s.conf,e))}function q(){if(!(this instanceof q))return new q;this.promise=new Promise(function(e){this.resolve=e}.bind(this))}function O(a,u){return new Promise(function(t){var e="asker_jsonp"+(new Date).getTime(),n="".concat(a.jsonp,"=").concat(e),r=a.uri,o=1<r.split("?").length;r+=(o?"&":"?")+n;var i=document.createElement("script");function s(){window[e]&&(delete window[e],document.body.removeChild(i))}i.src=r,window[e]=function(e){e=Object.assign({},u,{data:e,status:200,statusText:"jsonp",conf:a,request:r});t(e),s()},a.canceler&&a.canceler.promise.then(s),window[e]&&document.body.appendChild(i)})}function P(o){return new Promise(function(t,n){var e=o.adapter,r=T({},u,{conf:o}),e=d(e)?e(o,r):T(r,{data:e,request:null});(e instanceof Promise?e:Promise.resolve(e)).then(function(e){(d(o.validator)?o.validator(e.status):200<=e.status&&e.status<300)?t(e):n({message:"adapter return status: ".concat(e.status),status:e.status})})})}function A(a){return new Promise(function(n,r){var e,o=new XMLHttpRequest;function i(){o=null}o.onreadystatechange=function(){if(o&&4===o.readyState&&0!==o.status){if(!(d(a.validator)?a.validator(o.status):200<=o.status&&o.status<300))return r(j(o.status,o.responseText,a.errorResponseType&&"text"!==a.errorResponseType?"json"===a.errorResponseType?JSON.parse(o.responseText):o.response:o.responseText));var e=function(e){if(!d(e.getAllResponseHeaders))return null;var t,n,e=e.getAllResponseHeaders(),r={};return e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substr(0,n).trim().toLowerCase(),n=e.substr(n+1).trim(),t&&(r[t]&&E.includes(t)||(r[t]="set-cookie"===t?(r[t]||[]).concat([n]):r[t]?r[t]+", "+n:n))}),r}(o),t=a.responseType&&"text"!==a.responseType?"json"===a.responseType?JSON.parse(o.responseText):o.response:o.responseText,e=T({},u,{data:t,status:o.status,statusText:o.statusText,headers:e,conf:a,request:o});i(),n(e)}},o.onabort=function(){o&&(d(a.onAbort)?a.onAbort.call(null,c,o):r(j(o.status,c)),i())},o.onerror=function(){o&&(d(a.onError)?a.onError.call(null,f,o):r(j(o.status,f)),i())},o.ontimeout=function(){o&&(d(a.onTimeout)?a.onTimeout.call(null,l,o):r(j(o.status,l)),i())},h(e=a.timeout)&&0<e&&(o.timeout=a.timeout),o.open(a.method.toUpperCase(),a.uri,!0);var s=a.headers;v(function(e,t){a.body||"content-type"!==t.toLowerCase()?o.setRequestHeader(t,e):delete s[t]},s),m(a.withCredentials)||(o.withCredentials=!!a.withCredentials),d(a.onDownloadProgress)&&o.addEventListener("progress",function(e){a.onDownloadProgress.call(null,e,o,a)}),d(a.onUploadProgress)&&o.upload&&o.upload.addEventListener("progress",function(e){a.onUploadProgress.call(null,e,o,a)}),a.canceler&&a.canceler.promise.then(function(){o&&(o.abort(),i())}),o&&o.send(a.body)})}function S(e){var t=(e.baseUrl||"")+(e.url||"");y(e.params)&&(e.query=w(e.params),t+="?"+e.query),e.uri=t;var n,r=e.getCache,o=h(r)&&0<r,i=(r||o)&&(n=e.method,p.includes(n));if(i){if(g(x,t))return Promise.resolve(x[t]);o&&setTimeout(function(){g(x,t)&&delete x[t]},1e3*r+1)}var o=e.beforeQueue,r=e.catcher||function(e){return Promise.reject(e)},s=o.reduce(function(e,t){return t(e)},e);return(m(s.adapter)?A:P)(s).then(function(e){e=s.afterQueue.reduce(function(e,t){return t(e)},e);return i&&(x[t]=e),e}).catch(r)}function C(s){return function(e,t,n){var r=R(this.conf,n),n=T({},this.conf,n);if((n=Object.assign(n,r)).method=s,n.url=e,t){var o=n.headers||{},i=null;switch(n.postType){case"form-data":i=function(e){if(!y(e)&&!b(e))return e;var n=new FormData;return v(function(e,t){return n.append(t,e)},e),n}(t),delete o[a];break;case"text":i=t,o[a]="text/plain";break;case"form-urlencoded":i=w(t,!0),o[a]="application/x-www-form-urlencoded";break;case"json":default:i=JSON.stringify(t),o[a]="application/json"}n.body=i}return S(n)}}s.errorType={ABORT:c,ERROR:f,TIMEOUT:l},s.conf=T({},{url:"",baseUrl:"",query:"",body:null,headers:{},postType:"json",responseType:"json",errorResposeType:"text",timeout:0}),s.cache=x,q.prototype.cancel=function(e){this.resolve(e)};var U=(n(U={continue:100,switchingProtocols:101,processing:102,earlyHints:103,ok:200,created:201,accepted:202,nonauthoritativeInformation:203,noContent:204,resetContent:205,partialContent:206,multistatus:207,alreadyReported:208,imUsed:226,multipleChoices:300,movedPermanently:301,found:302,seeOther:303,notModified:304,useProxy:305,switchProxy:306,temporaryRedirect:307,permanentRedirect:308,badRequest:400,unauthorized:401,paymentRequired:402,forbidden:403,notFound:404,methodNotAllowed:405,notAcceptable:406,proxyAuthenticationRequired:407,requestTimeout:408,conflict:409,gone:410,lengthRequired:411,preconditionFailed:412,requestEntityTooLarge:413,requesturiTooLong:414,unsupportedMediaType:415,requestedRangeNotSatisfiable:416,expectationFailed:417,iAmATeapot:418,misdirectedRequest:421,unprocessableEntity:422,locked:423},"unprocessableEntity",424),n(U,"tooEarly",425),n(U,"upgradeRequired",426),n(U,"preconditionRequired",428),n(U,"tooManyRequests",429),n(U,"requestHeaderFieldsTooLarge",431),n(U,"unavailableForLegalReasons",451),n(U,"internalServerError",500),n(U,"notImplemented",501),n(U,"badGateway",502),n(U,"serviceUnavailable",503),n(U,"gatewayTimeout",504),n(U,"httpVersionNotSupported",505),n(U,"variantAlsoNegotiates",506),n(U,"insufficientStorage",507),n(U,"loopDetected",508),n(U,"notExtended",510),n(U,"networkAuthenticationRequired",511),U),k=null;p.forEach(function(e){var o;s.prototype[e]=(o=e,function(e,t,n){var r=R(this.conf,n),n=T({},this.conf,n);return(n=Object.assign(n,r)).method=o,n.url=e,n.params=t,S(n)})}),r.forEach(function(e){s.prototype[e]=C(e)}),p.concat(r).concat(["jsonp","batch"]).forEach(function(e){s[e]=function(){return(k=k||new s)[e].apply(k,arguments)}}),s.prototype.jsonp=function(e,t,n){return n=n||{},o(t)&&(n.jsonp=t,t=void 0),n.method="get",n.adapter=O,this.get(e,t,n)},s.prototype.batch=function(n,e,r){e=Array.isArray(e)?e:[e];var i=new Map;e.forEach(function(e,t){return i.set(e,t)});var s=this,a=r.method||"get",t=r.slice||e.length,u=r.retry||0,c=[],o=e.slice(0,t),f=e.slice(t),l=new Map;return new Promise(function(e,t){Promise.all(o.map(function(e){return function e(t,n,r,o){return s[a](t,n,r).then(function(e){c[i.get(n)]=e}).catch(function(e){l.get(n)||l.set(n,0);var t=l.get(n);return t<u?(l.set(n,t+1),o.push(n),Promise.resolve()):Promise.reject({error:e,batch:n,all:Array.from(l.keys())})}).then(function(){if(0<o.length)return e(t,o.shift(),r,o)})}(n,e,r,f)})).then(function(){e(c)}).catch(function(e){t(e)})})},e.Asker=s,e.Canceler=q,e.HttpStatus=U,e.object2Query=w,e.query2Object=function(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return o(e)?(e=e.replace(/^.*\?/,"")).split("&").reduce(function(e,t){var n=t.split("=");if(2===n.length){t=n[1];if(r)try{t=JSON.parse(t)}catch(e){}e[n[0]]=t}return e},{}):e},e.safeCall=function(n){return function(e){var t;try{(t=e(n))instanceof Promise&&(t=t.catch(n))}catch(e){n(e)}return t}},e.splitBlob=function(e,t){if(!window.Blob)return e?[e]:[];if(!(e instanceof Blob))throw TypeError("first must be a Blob");if("number"!=typeof t)throw ReferenceError('must set a "piece" size');for(var n=e.size,r=0,o=r+t,i=[];r<n;){var s=e.slice(r,o);i.push(s),o=(o=(r=o)+t)<n?o:n}return i},Object.defineProperty(e,"__esModule",{value:!0})});
