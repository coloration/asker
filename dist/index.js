!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).asker={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i="Content-Type",u={data:null,status:200,statusText:"you skip request and success always",headers:{},conf:{},request:null},c="ASKER:REQUEST_ABORT",f="ASKER:REQUEST_ERROR",l="ASKER:REQUEST_TIMEOUT",p=["get","delete","head","options"],n=["post","put","patch"];function d(e){return"function"==typeof e}function h(e){return"[object Object]"===Object.prototype.toString.call(e)}function y(e){return"number"==typeof e&&!isNaN(e)}function m(e){return void 0===e}function b(e){return Array.isArray(e)}function s(e){return h(e)||b(e)}function o(e){return"string"==typeof e}function v(n,r){if(null!=r)if("object"!=t(r))n(r,0,r);else if(b(r))r.forEach(function(e,t){n.call(null,e,t,r)});else for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&n.call(null,r[e],e,r)}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!h(e))return"";var r=[];return v(function(e,t){e=n?encodeURIComponent(e):e,r.push("".concat(t,"=").concat(e))},e),r.join("&")}function T(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(s),o=r.shift();return r.reduce(function(r,e){if(!s(e))throw TypeError("merge a ".concat(e," to object"));return v(function(e,t){var n=r[t];h(e)?r[t]=T(h(n)?n:{},e):b(e)?r[t]=T(b(n)?n:[],e):r[t]=e},e),r},o),o}function R(){var n=[],r=[];return Array.from(arguments).filter(function(e){return e}).forEach(function(e){var t=e.before,e=e.after;(d(t)||b(t))&&(n=n.concat(t)),(d(e)||b(e))&&(r=r.concat(e))}),{beforeQueue:n,afterQueue:r}}var E=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];function j(e,t,n){return{status:e,message:t,response:n}}var x={};function r(e){if(!(this instanceof r))return new r(e);var t=T({},r.conf,e);this.conf=Object.assign(t,R(r.conf,e))}function a(){if(!(this instanceof a))return new a;this.promise=new Promise(function(e){this.resolve=e}.bind(this))}function q(i,u){return new Promise(function(t){var e="asker_jsonp"+(new Date).getTime(),n="".concat(i.jsonp,"=").concat(e),r=i.uri,o=1<r.split("?").length;r+=(o?"&":"?")+n;var s=document.createElement("script");function a(){window[e]&&(delete window[e],document.body.removeChild(s))}s.src=r,window[e]=function(e){e=Object.assign({},u,{data:e,status:200,statusText:"jsonp",conf:i,request:r});t(e),a()},i.canceler&&i.canceler.promise.then(a),window[e]&&document.body.appendChild(s)})}function A(o){return new Promise(function(t,n){var e=o.adapter,r=T({},u,{conf:o}),e=d(e)?e(o,r):T(r,{data:e,request:null});(e instanceof Promise?e:Promise.resolve(e)).then(function(e){(d(o.validator)?o.validator(e.status):200<=e.status&&e.status<300)?t(e):n({message:"adapter return status: ".concat(e.status),status:e.status})})})}function O(i){return new Promise(function(n,r){var e,o=new XMLHttpRequest;function s(){o=null}o.onreadystatechange=function(){if(o&&4===o.readyState&&0!==o.status){if(!(d(i.validator)?i.validator(o.status):200<=o.status&&o.status<300))return r(j(o.status,o.responseText,i.errorResponseType&&"text"!==i.errorResponseType?"json"===i.errorResponseType?JSON.parse(o.responseText):o.response:o.responseText));var e=function(e){if(!d(e.getAllResponseHeaders))return null;var t,n,e=e.getAllResponseHeaders(),r={};return e.split("\n").forEach(function(e){n=e.indexOf(":"),t=e.substr(0,n).trim().toLowerCase(),n=e.substr(n+1).trim(),t&&(r[t]&&E.includes(t)||(r[t]="set-cookie"===t?(r[t]||[]).concat([n]):r[t]?r[t]+", "+n:n))}),r}(o),t=i.responseType&&"text"!==i.responseType?"json"===i.responseType?JSON.parse(o.responseText):o.response:o.responseText,e=T({},u,{data:t,status:o.status,statusText:o.statusText,headers:e,conf:i,request:o});s(),n(e)}},o.onabort=function(){o&&(d(i.onAbort)?i.onAbort.call(null,c,o):r(j(o.status,c)),s())},o.onerror=function(){o&&(d(i.onError)?i.onError.call(null,f,o):r(j(o.status,f)),s())},o.ontimeout=function(){o&&(d(i.onTimeout)?i.onTimeout.call(null,l,o):r(j(o.status,l)),s())},y(e=i.timeout)&&0<e&&(o.timeout=i.timeout),o.open(i.method.toUpperCase(),i.uri,!0);var a=i.headers;v(function(e,t){i.body||"content-type"!==t.toLowerCase()?o.setRequestHeader(t,e):delete a[t]},a),m(i.withCredentials)||(o.withCredentials=!!i.withCredentials),d(i.onDownloadProgress)&&o.addEventListener("progress",function(e){i.onDownloadProgress.call(null,e,o,i)}),d(i.onUploadProgress)&&o.upload&&o.upload.addEventListener("progress",function(e){i.onUploadProgress.call(null,e,o,i)}),i.canceler&&i.canceler.promise.then(function(){o&&(o.abort(),s())}),o&&o.send(i.body)})}function P(e){var t=(e.baseUrl||"")+(e.url||"");h(e.params)&&(e.query=w(e.params),t+="?"+e.query),e.uri=t;var n,r=e.getCache,o=y(r)&&0<r,s=(r||o)&&(n=e.method,p.includes(n));if(s){if(g(x,t))return Promise.resolve(x[t]);o&&setTimeout(function(){g(x,t)&&delete x[t]},1e3*r+1)}var o=e.beforeQueue,r=e.catcher||function(e){return Promise.reject(e)},a=o.reduce(function(e,t){return t(e)},e);return(m(a.adapter)?O:A)(a).then(function(e){e=a.afterQueue.reduce(function(e,t){return t(e)},e);return s&&(x[t]=e),e}).catch(r)}function S(a){return function(e,t,n){var r=R(this.conf,n),n=T({},this.conf,n);if((n=Object.assign(n,r)).method=a,n.url=e,t){var o=n.headers||{},s=null;switch(n.postType){case"form-data":s=function(e){if(!h(e)&&!b(e))return e;var n=new FormData;return v(function(e,t){return n.append(t,e)},e),n}(t),delete o[i];break;case"text":s=t,o[i]="text/plain";break;case"form-urlencoded":s=w(t,!0),o[i]="application/x-www-form-urlencoded";break;case"json":default:s=JSON.stringify(t),o[i]="application/json"}n.body=s}return P(n)}}r.errorType={ABORT:c,ERROR:f,TIMEOUT:l},r.conf=T({},{url:"",baseUrl:"",query:"",body:null,headers:{},postType:"json",responseType:"json",errorResposeType:"text",timeout:0}),r.cache=x,a.prototype.cancel=function(e){this.resolve(e)};var C=null;p.forEach(function(e){var o;r.prototype[e]=(o=e,function(e,t,n){var r=R(this.conf,n),n=T({},this.conf,n);return(n=Object.assign(n,r)).method=o,n.url=e,n.params=t,P(n)})}),n.forEach(function(e){r.prototype[e]=S(e)}),p.concat(n).concat(["jsonp","batch"]).forEach(function(e){r[e]=function(){return(C=C||new r)[e].apply(C,arguments)}}),r.prototype.jsonp=function(e,t,n){return n=n||{},o(t)&&(n.jsonp=t,t=void 0),n.method="get",n.adapter=q,this.get(e,t,n)},r.prototype.batch=function(n,e,r){e=Array.isArray(e)?e:[e];var s=new Map;e.forEach(function(e,t){return s.set(e,t)});var a=this,i=r.method||"get",t=r.slice||e.length,u=r.retry||0,c=[],o=e.slice(0,t),f=e.slice(t),l=new Map;return new Promise(function(e,t){Promise.all(o.map(function(e){return function e(t,n,r,o){return a[i](t,n,r).then(function(e){c[s.get(n)]=e}).catch(function(e){l.get(n)||l.set(n,0);var t=l.get(n);return t<u?(l.set(n,t+1),o.push(n),Promise.resolve()):Promise.reject({error:e,batch:n,all:Array.from(l.keys())})}).then(function(){if(0<o.length)return e(t,o.shift(),r,o)})}(n,e,r,f)})).then(function(){e(c)}).catch(function(e){t(e)})})},e.Asker=r,e.Canceler=a,e.HttpStatus={continue:100,switchingProtocols:101,processing:102,earlyHints:103,ok:200,created:201,accepted:202,nonauthoritativeInformation:203,noContent:204,resetContent:205,partialContent:206,multistatus:207,alreadyReported:208,imUsed:226,multipleChoices:300,movedPermanently:301,found:302,seeOther:303,notModified:304,useProxy:305,switchProxy:306,temporaryRedirect:307,permanentRedirect:308,badRequest:400,unauthorized:401,paymentRequired:402,forbidden:403,notFound:404,methodNotAllowed:405,notAcceptable:406,proxyAuthenticationRequired:407,requestTimeout:408,conflict:409,gone:410,lengthRequired:411,preconditionFailed:412,requestEntityTooLarge:413,requesturiTooLong:414,unsupportedMediaType:415,requestedRangeNotSatisfiable:416,expectationFailed:417,iAmATeapot:418,misdirectedRequest:421,unprocessableEntity:422,locked:423,failedDependency:424,tooEarly:425,upgradeRequired:426,preconditionRequired:428,tooManyRequests:429,requestHeaderFieldsTooLarge:431,unavailableForLegalReasons:451,internalServerError:500,notImplemented:501,badGateway:502,serviceUnavailable:503,gatewayTimeout:504,httpVersionNotSupported:505,variantAlsoNegotiates:506,insufficientStorage:507,loopDetected:508,notExtended:510,networkAuthenticationRequired:511},e.object2Query=w,e.query2Object=function(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return o(e)?(e=e.replace(/^.*\?/,"")).split("&").reduce(function(e,t){var n=t.split("=");if(2===n.length){t=n[1];if(r)try{t=JSON.parse(t)}catch(e){}e[n[0]]=t}return e},{}):e},e.safeCall=function(n){return function(e){var t;try{(t=e(n))instanceof Promise&&(t=t.catch(n))}catch(e){n(e)}return t}},e.splitBlob=function(e,t){if(!window.Blob)return e?[e]:[];if(!(e instanceof Blob))throw TypeError("first must be a Blob");if("number"!=typeof t)throw ReferenceError('must set a "piece" size');for(var n=e.size,r=0,o=r+t,s=[];r<n;){var a=e.slice(r,o);s.push(a),o=(o=(r=o)+t)<n?o:n}return s},Object.defineProperty(e,"__esModule",{value:!0})});
