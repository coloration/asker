!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).asker={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c="Content-Type",u={data:null,status:200,statusText:"you skip request and success always",headers:{},conf:{},request:null},f="ASKER:REQUEST_ABORT",l="ASKER:REQUEST_ERROR",p="ASKER:REQUEST_TIMEOUT",s=["get","delete","head","options"],n=["post","put","patch"];function d(e){return"function"==typeof e}function h(e){return"[object Object]"===(t=e,Object.prototype.toString.call(t));var t}function y(e){return"number"==typeof e&&!isNaN(e)}function m(e){return void 0===e}function v(e){return Array.isArray(e)}function a(e){return h(e)||v(e)}function r(e){return"string"==typeof e}function b(n,r){if(null!=r)if("object"!=t(r))n(r,0,r);else if(v(r))r.forEach(function(e,t){n.call(null,e,t,r)});else for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&n.call(null,r[e],e,r)}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!h(e))return"";var r=[];return b(function(e,t){e=n?encodeURIComponent(e):e,r.push("".concat(t,"=").concat(e))},e),r.join("&")}function T(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(a),o=r.shift();return r.reduce(function(r,e){if(!a(e))throw TypeError("merge a ".concat(e," to object"));return b(function(e,t){var n=r[t];h(e)?r[t]=T(h(n)?n:{},e):v(e)?r[t]=T(v(n)?n:[],e):r[t]=e},e),r},o),o}function E(){var r=[],o=[];return Array.from(arguments).filter(function(e){return e}).forEach(function(e){var t=e.before,n=e.after;(d(t)||v(t))&&(r=r.concat(t)),(d(n)||v(n))&&(o=o.concat(n))}),{beforeQueue:r,afterQueue:o}}var j=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];function R(e,t){return{status:e,message:t}}var O={};function o(e){if(!(this instanceof o))return new o(e);var t=T({},o.conf,e);this.conf=Object.assign(t,E(o.conf,e))}function i(){if(!(this instanceof i))return new i;this.promise=new Promise(function(e){this.resolve=e}.bind(this))}function A(s,u){return new Promise(function(n){var e="asker_jsonp"+(new Date).getTime(),t="".concat(s.jsonp,"=").concat(e),r=s.uri,o=1<r.split("?").length;r+=(o?"&":"?")+t;var a=document.createElement("script");function i(){window[e]&&(delete window[e],document.body.removeChild(a))}a.src=r,window[e]=function(e){var t=Object.assign({},u,{data:e,status:200,statusText:"jsonp",conf:s,request:r});n(t),i()},s.canceler&&s.canceler.promise.then(i),window[e]&&document.body.appendChild(a)})}function P(a){return new Promise(function(t,n){var e=a.adapter,r=T({},u,{conf:a}),o=d(e)?e(a,r):T(r,{data:e,request:null});(o instanceof Promise?o:Promise.resolve(o)).then(function(e){(d(a.validator)?a.validator(e.status):200<=e.status&&e.status<300)?t(e):n({message:"adapter return status: ".concat(e.status),status:e.status})})})}function x(s){return new Promise(function(r,o){var e,a=new XMLHttpRequest;function i(){a=null}a.onreadystatechange=function(){if(a&&4===a.readyState&&0!==a.status){if(!(d(s.validator)?s.validator(a.status):200<=a.status&&a.status<300))return o(R(a.status,a.responseText));var e=function(e){if(!d(e.getAllResponseHeaders))return null;var t,n,r,o=e.getAllResponseHeaders(),a={};return o.split("\n").forEach(function(e){if(r=e.indexOf(":"),t=e.substr(0,r).trim().toLowerCase(),n=e.substr(r+1).trim(),t){if(a[t]&&j.includes(t))return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}}),a}(a),t=s.responseType&&"text"!==s.responseType?"json"===s.responseType?JSON.parse(a.responseText):a.response:a.responseText,n=T({},u,{data:t,status:a.status,statusText:a.statusText,headers:e,conf:s,request:a});i(),r(n)}},a.onabort=function(){a&&(d(s.onAbort)?s.onAbort.call(null,f,a):o(R(a.status,f)),i())},a.onerror=function(){a&&(d(s.onError)?s.onError.call(null,l,a):o(R(a.status,l)),i())},a.ontimeout=function(){a&&(d(s.onTimeout)?s.onTimeout.call(null,p,a):o(R(a.status,p)),i())},y(e=s.timeout)&&0<e&&(a.timeout=s.timeout),a.open(s.method.toUpperCase(),s.uri,!0);var n=s.headers;b(function(e,t){s.body||"content-type"!==t.toLowerCase()?a.setRequestHeader(t,e):delete n[t]},n),m(s.withCredentials)||(a.withCredentials=!!s.withCredentials),d(s.onDownloadProgress)&&a.addEventListener("progress",function(e){s.onDownloadProgress.call(null,e,a,s)}),d(s.onUploadProgress)&&a.upload&&a.upload.addEventListener("progress",function(e){s.onUploadProgress.call(null,e,a,s)}),s.canceler&&s.canceler.promise.then(function(){a&&(a.abort(),i())}),a&&a.send(s.body)})}function S(e){var n=(e.baseUrl||"")+(e.url||"");h(e.params)&&(e.query=w(e.params),n+="?"+e.query),e.uri=n;var t,r=e.getCache,o=y(r)&&0<r,a=(r||o)&&(t=e.method,s.includes(t));if(a){if(g(O,n))return console.log("f"),Promise.resolve(O[n]);o&&setTimeout(function(){g(O,n)&&delete O[n]},1e3*r+1)}var i=e.beforeQueue.reduce(function(e,t){return t(e)},e);return(m(i.adapter)?x:P)(i).then(function(e){var t=i.afterQueue.reduce(function(e,t){return t(e)},e);return a&&(O[n]=t),t})}function q(u){return function(e,t,n){var r,o=E(this.conf,n),a=T({},this.conf,n);if((a=Object.assign(a,o)).method=u,a.url=e,t){var i=a.headers||{},s=null;switch(a.postType){case"form-data":s=function(e){if(!h(e)&&!v(e))return e;var n=new FormData;return b(function(e,t){return n.append(t,e)},e),n}(t),delete i[c];break;case"text":s=t,i[c]="text/plain";break;case"form-urlencoded":s=w(t,!0),i[c]="application/x-www-form-urlencoded";break;case"json":default:r=t,s=JSON.stringify(r),i[c]="application/json"}a.body=s}return S(a)}}o.errorType={ABORT:f,ERROR:l,TIMEOUT:p},o.conf=T({},{url:"",baseUrl:"",query:"",body:null,headers:{},postType:"json",responseType:"json",timeout:0}),o.cache=O,i.prototype.cancel=function(e){this.resolve(e)};var C=null;s.forEach(function(e){var a;o.prototype[e]=(a=e,function(e,t,n){var r=E(this.conf,n),o=T({},this.conf,n);return(o=Object.assign(o,r)).method=a,o.url=e,o.params=t,S(o)})}),n.forEach(function(e){o.prototype[e]=q(e)}),s.concat(n).concat(["jsonp","batch"]).forEach(function(e){o[e]=function(){return(C=C||new o)[e].apply(C,arguments)}}),o.prototype.jsonp=function(e,t,n){return n=n||{},r(t)&&(n.jsonp=t,t=void 0),n.method="get",n.adapter=A,this.get(e,t,n)},o.prototype.batch=function(n,e,r){e=Array.isArray(e)?e:[e];var a=new Map;e.forEach(function(e,t){return a.set(e,t)});var i=this,s=r.method||"get",t=r.slice||e.length,u=r.retry||0,c=[],o=e.slice(0,t),f=e.slice(t),l=new Map;return new Promise(function(e,t){Promise.all(o.map(function(e,t){return function e(t,n,r,o){return i[s](t,n,r).then(function(e){c[a.get(n)]=e}).catch(function(e){l.get(n)||l.set(n,0);var t=l.get(n);return t<u?(l.set(n,t+1),o.push(n),Promise.resolve()):Promise.reject({error:e,batch:n,all:Array.from(l.keys())})}).then(function(){if(0<o.length)return e(t,o.shift(),r,o)})}(n,e,r,f)})).then(function(){e(c)}).catch(function(e){t(e)})})},e.Asker=o,e.Canceler=i,e.HttpStatus={continue:100,switchingProtocols:101,processing:102,ok:200,created:201,accepted:202,nonauthoritativeInformation:203,noContent:204,resetContent:205,partialContent:206,ambiguous:300,movedPermanently:301,found:302,seeOther:303,notModified:304,temporaryRedirect:307,permanentRedirect:308,badRequest:400,unauthorized:401,paymentRequired:402,forbidden:403,notFound:404,methodNotAllowed:405,notAcceptable:406,proxyAuthenticationRequired:407,requestTimeout:408,conflict:409,gone:410,lengthRequired:411,preconditionFailed:412,payloadTooLarge:413,uriTooLong:414,unsupportedMediaType:415,requestedRangeNotSatisfiable:416,expectationFailed:417,iAmATeapot:418,unprocessableEntity:422,tooManyRequests:429,internalServerError:500,notImplemented:501,badGateway:502,serviceUnavailable:503,gatewayTimeout:504,httpVersionNotSupported:505},e.object2Query=w,e.query2Object=function(e){var o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return r(e)?(e=e.replace(/^.*\?/,"")).split("&").reduce(function(e,t){var n=t.split("=");if(2===n.length){var r=n[1];if(o)try{r=JSON.parse(r)}catch(e){}e[n[0]]=r}return e},{}):e},e.safeCall=function(n){return function(e){var t;try{(t=e(n))instanceof Promise&&(t=t.catch(n))}catch(e){n(e)}return t}},e.splitBlob=function(e,t){if(!window.Blob)return e?[e]:[];if(!(e instanceof Blob))throw TypeError("first must be a Blob");if("number"!=typeof t)throw ReferenceError('must set a "piece" size');for(var n=e.size,r=0,o=r+t,a=[];r<n;){var i=e.slice(r,o);a.push(i),o=(o=(r=o)+t)<n?o:n}return a},Object.defineProperty(e,"__esModule",{value:!0})});
